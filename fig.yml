image:
  build: .

web:
  image: groundsio_image
  command: rake run
  ports:
    - '3000:3000'
  links:
    - redis
  volumes:
    - .:/grounds
  environment:
    - RAILS_ENV
    - DOCKER_URL
    - SECRET_KEY_BASE
    - NEWRELIC_LICENSE_KEY
    - NEWRELIC_APP_NAME

test:
  image: groundsio_image
  command: rake test
  environment:
    - TEST_OPTS
    - DOCKER_URL

redis:
  image: dockerfile/redis
  expose:
    - '6379'
  volumes:
    - /redis:/data

runner:
  image: grounds/grounds-exec
  command: hack/server.sh
  ports:
    - '8080:8080'
  volumes:
    - $DOCKER_CERT_PATH:/home/.docker
  environment:
    - DOCKER_URL
    - REPOSITORY
